#!/usr/bin/env python3

import json
import surfex
import sys
import argparse


def parse():
    """Parse the command line input arguments."""
    parser = argparse.ArgumentParser()

    parser.add_argument('--version', action='version', version='surfex {0}'.format(surfex.__version__))
    parser.add_argument('--json', '-j', type=str, nargs="+", required=True, help="A JSON file with run options")
    parser.add_argument('--toml', '-t', type=str, required=True,
                        help="A TOML configuration file to be parsed to json file with run options")

    parser.add_argument('--indent', required=False, default=2, type=int, help="Indented output")
    parser.add_argument('--output', '-o', type=str, required=True, help="Merged JSON file")

    if len(sys.argv) == 1:
        parser.print_help()
        sys.exit()

    args = parser.parse_args()

    return args.json, args.toml, args.output, args.indent


if __name__ == "__main__":

    json_files, toml_file, output_file, indent = parse()
    json_settings = surfex.create_json_from_toml(json_files, toml_file)
    fh = open(output_file, "w")
    json.dump(json_settings, fh, indent=indent)
    fh.close()

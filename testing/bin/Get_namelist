#!/bin/bash

if [ "$#" -lt "2" ]; then
  echo "Usage: $0 namelist module1 [ module2 .... moduleN ]"
  exit 1
else

  # Arguments
  NAMELIST=$1
  shift
  MODULES="$@"

  if [ $NAMELIST == ALL ] ; then
   NAMELISTS="pgd prep offline assim"
   TARGET="FILE"
  else
    NAMELISTS=$NAMELIST
  fi

  for NAMELIST in $NAMELISTS ; do

   case $NAMELIST in
     pgd|prep|assim)
       NAMELIST_CONFIG="default $NAMELIST"
     ;;
     offline)
       NAMELIST_CONFIG="default diag $NAMELIST"
     ;;
     *)
       echo "Namelist $NAMELIST not defined!"
       exit 1
     ;;
   esac
 
   string=""
   for mod in $MODULES; do
     string="$string -n $mod -a $NAMELIST_CONFIG"
   done

   OUT=""
   [ "$TARGET" == "FILE" ] && OUT="> OPTIONS.nam_$NAMELIST"
   # Generate the namelist
   gen_namelist.pl $string $OUT || { echo "Could not create $TARGET" ; exit 1 ; }

  done
fi
